<!DOCTYPE html>
<html lang="zh">
<head>
Â  Â  <meta charset="utf-8">
Â  Â  <title>æ‰‹èªè¾¨è­˜å°ˆé¡Œ</title>
Â  Â  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; media-src *;">
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-button {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 20px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  background-color: blue;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-button:hover {
Â  Â  Â  Â  Â  Â  background-color: darkblue;
Â  Â  Â  Â  }

Â  Â  Â  Â  #user-info {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 20px;
Â  Â  Â  Â  Â  Â  right: 120px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }

Â  Â  Â  Â  #auth-required {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  flex-direction: row;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: calc(100vh); /* ä¿ç•™ä¸‹ç§»ç©ºé–“ */
Â  Â  Â  Â  }

Â  Â  Â  Â  #left-panel, #right-panel {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  width: 50%;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  video {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 640px;
Â  Â  Â  Â  Â  Â  border: 2px solid black;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  button {
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  background-color: #4CAF50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  button:hover {
Â  Â  Â  Â  Â  Â  background-color: #45a049;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ====== START: æœå°‹æ¬„ä½èª¿æ•´ ====== */
Â  Â  Â  Â  #search-container {
Â  Â  Â  Â  Â  Â  /* é™åˆ¶æ•´å€‹æœå°‹å€å¡Šçš„æœ€å¤§å¯¬åº¦ */
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 350px; /* **è¨­å®šæœ€å¤§å¯¬åº¦ï¼Œè®“æœå°‹æ¬„è®ŠçŸ­** */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: row; /* è®“è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•ä¸¦æ’ */
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px; /* å¢åŠ èˆ‡ä¸‹æ–¹è¦–è¨Šæ’­æ”¾å™¨çš„é–“è· */
Â  Â  Â  Â  }

Â  Â  Â  Â  #search-input {
Â  Â  Â  Â  Â  Â  width: 100%; /* ä½”æ»¿ search-container å…§å¤§éƒ¨åˆ†ç©ºé–“ */
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  margin-bottom: 0; /* ç§»é™¤åŸæœ¬çš„ margin-bottom */
Â  Â  Â  Â  Â  Â  margin-right: 10px; /* èˆ‡æŒ‰éˆ•ä¿æŒé–“è· */
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #search-button {
Â  Â  Â  Â  Â  Â  margin-top: 0; /* ç§»é™¤åŸæœ¬çš„ margin-top */
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  flex-shrink: 0; /* ç¢ºä¿æŒ‰éˆ•ä¸æœƒè¢«å£“ç¸® */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* ====== END: æœå°‹æ¬„ä½èª¿æ•´ ====== */


Â  Â  Â  Â  #result-box {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  border: 2px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #navigation {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  #navigation ul {
Â  Â  Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  #navigation li {
Â  Â  Â  Â  Â  Â  display: inline;
Â  Â  Â  Â  Â  Â  margin-right: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #navigation a {
Â  Â  Â  Â  Â  Â  color: blue;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  #navigation a:hover {
Â  Â  Â  Â  Â  Â  color: darkblue;
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  min-height: calc(100vh);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(to right, #7f7fd5, #86a8e7, #91eae4);
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login-box {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  padding: 40px;
Â  Â  Â  Â  Â  Â  border: 2px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login-box h2 {
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login-box p {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login-box button {
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  background-color: #4CAF50;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  #please-login-box button:hover {
Â  Â  Â  Â  Â  Â  background-color: #45a049;
Â  Â  Â  Â  }

Â  Â  Â  Â  #not-logged-in-icon {
Â  Â  Â  Â  Â  Â  font-size: 48px;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #video-container {
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>

Â  <script>
Â  Â  // Firebase åˆå§‹åŒ–
Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyCiB7v1mdKuPMIB3SUHPpmriSXmAsQ5G3M",
Â  Â  Â  authDomain: "hand-sign-project.firebaseapp.com",
Â  Â  Â  projectId: "hand-sign-project",
Â  Â  Â  storageBucket: "hand-sign-project.firebasestorage.app",
Â  Â  Â  messagingSenderId: "338082830115",
Â  Â  Â  appId: "1:338082830115:web:95ca6cd329dc49b1191e96"
Â  Â  };
Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const db = firebase.firestore();
Â  Â  const auth = firebase.auth();
Â  </script>

Â  <button id="login-button">ç™»å…¥ç³»çµ±</button>
Â  <div id="user-info"></div>

Â  <div id="please-login">
Â  Â  <div id="please-login-box">
Â  Â  Â  <h2>è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æ‰‹èªè¾¨è­˜</h2>
Â  Â  Â  <p>ç™»å…¥å¾Œå³å¯ä½¿ç”¨æœå°‹èˆ‡æ”å½±æ©Ÿè¾¨è­˜åŠŸèƒ½</p>
Â  Â  Â  <button onclick="window.location.href='login.html'">ç«‹å³ç™»å…¥</button>
Â  Â  Â  <div id="not-logged-in-icon">ğŸ”’</div>
Â  Â  </div>
Â  </div>

Â  <div id="auth-required">
Â  Â  <div id="left-panel">
Â  Â  Â  <h1>ğŸ– æ‰‹èªè¾¨è­˜ç³»çµ±</h1>
Â  Â  Â  <video id="camera" autoplay playsinline></video>
Â  Â  Â  <button id="toggle-camera" onclick="toggleCamera()">é—œé–‰æ”å½±æ©Ÿ</button>
Â  Â  Â  <div id="detect-result">ğŸ” æ¨¡å‹è¼‰å…¥ä¸­...</div>
Â  Â  </div>

Â  Â  <div id="right-panel">
Â  Â  Â  Â  Â  Â  <div id="search-container">
Â  Â  Â  Â  <input id="search-input" type="text" placeholder="è¼¸å…¥æ‰‹èªä¸­æ–‡..." list="suggestions">
Â  Â  Â  Â  <datalist id="suggestions"></datalist>
Â  Â  Â  Â  <button id="search-button">æœå°‹</button>
Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <video id="sign-video" controls></video>
Â  Â  Â  <div id="result-box"><p id="result-text">è«‹è¼¸å…¥è¦æŸ¥è©¢çš„æ‰‹èª</p></div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  let stream, session;
Â  Â  let cameraOn = true;

Â  Â  async function startCamera() {
Â  Â  Â  try {
Â  Â  Â  Â  stream = await navigator.mediaDevices.getUserMedia({ video: true });
Â  Â  Â  Â  document.getElementById('camera').srcObject = stream;
Â  Â  Â  } catch(e) {
Â  Â  Â  Â  alert('ç„¡æ³•é–‹å•Ÿæ”å½±æ©Ÿ:' + e.message);
Â  Â  Â  }
Â  Â  }

Â  Â  async function toggleCamera() {
Â  Â  Â  if(cameraOn){
Â  Â  Â  Â  if(stream){
Â  Â  Â  Â  Â  stream.getTracks().forEach(t=>t.stop());
Â  Â  Â  Â  Â  document.getElementById('camera').srcObject = null;
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('toggle-camera').textContent='é–‹å•Ÿæ”å½±æ©Ÿ';
Â  Â  Â  } else {
Â  Â  Â  Â  await startCamera();
Â  Â  Â  Â  document.getElementById('toggle-camera').textContent='é—œé–‰æ”å½±æ©Ÿ';
Â  Â  Â  }
Â  Â  Â  cameraOn = !cameraOn;
Â  Â  }

Â  Â  async function loadModel() {
Â  Â  Â  try {
Â  Â  Â  Â  session = await ort.InferenceSession.create('https://lifandi-byte.github.io/models/best.onnx');
Â  Â  Â  Â  document.getElementById('detect-result').textContent='âœ… æ¨¡å‹å·²è¼‰å…¥';
Â  Â  Â  Â  console.log("æ¨¡å‹ session", session);

Â  Â  Â  } catch(e) {
Â  Â  document.getElementById('detect-result').textContent=`âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—: ${e.message}`;
Â  Â  Â  Â  Â Â 
Â  Â  Â  }
Â  Â  }

Â  Â  function search() {
Â  Â  Â  const query = document.getElementById('search-input').value.trim();
Â  Â  Â  if(!query){Â 
Â  Â  Â  Â  document.getElementById('result-text').textContent='è«‹è¼¸å…¥æ‰‹èªåç¨±';Â 
Â  Â  Â  Â  return;Â 
Â  Â  Â  }
Â  Â  Â  document.getElementById('result-text').textContent='æœå°‹ä¸­...';
Â  Â  Â  db.collection('sign').where('chinese','==',query).get()
Â  Â  Â  Â  .then(snap => {Â 
Â  Â  Â  Â  Â  if(snap.empty) {
Â  Â  Â  Â  Â  Â  document.getElementById('result-text').textContent=`æ‰¾ä¸åˆ°ã€Œ${query}ã€çš„è³‡æ–™`;Â 
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  snap.forEach(doc => {Â 
Â  Â  Â  Â  Â  Â  Â  const d = doc.data();Â 
Â  Â  Â  Â  Â  Â  Â  document.getElementById('result-text').textContent=`ä¸­æ–‡:${d.chinese} è‹±æ–‡:${d.english}`;Â 
Â  Â  Â  Â  Â  Â  Â  if(d.videoUrl) document.getElementById('sign-video').src = d.videoUrl;Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {Â 
Â  Â  Â  Â  Â  document.getElementById('result-text').textContent='æŸ¥è©¢éŒ¯èª¤:'+e.message;Â 
Â  Â  Â  Â  });
Â  Â  }

Â  Â  document.getElementById('search-button').onclick = search;
Â  Â  document.getElementById('search-input').addEventListener('keydown', e => { if(e.key==='Enter') search(); });

Â  Â  window.onload = async () => {
Â  Â  Â  const loginBtn = document.getElementById('login-button');
Â  Â  Â  const userInfo = document.getElementById('user-info');
Â  Â  Â  const pleaseLogin = document.getElementById('please-login');
Â  Â  Â  const authReq = document.getElementById('auth-required');

Â  Â  Â  firebase.auth().onAuthStateChanged(async user => {
Â  Â  Â  Â  if(user){
Â  Â  Â  Â  Â  loginBtn.textContent='ç™»å‡º';
Â  Â  Â  Â  Â  loginBtn.onclick = () => firebase.auth().signOut().then(()=>location.reload());
Â  Â  Â  Â  Â  userInfo.textContent=`ğŸ‘‹ ${user.email}`;
Â  Â  Â  Â  Â  pleaseLogin.style.display='none';Â 
Â  Â  Â  Â  Â  authReq.style.display='flex';
Â  Â  Â  Â  Â  await startCamera();
Â  Â  Â  Â  Â  await loadModel();
Â  Â  Â  Â  Â  const suggestions = document.getElementById('suggestions');
Â  Â  Â  Â  Â  db.collection('sign').get().then(snap => {Â 
Â  Â  Â  Â  Â  Â  snap.forEach(doc => {Â 
Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');Â 
Â  Â  Â  Â  Â  Â  Â  option.value = doc.data().chinese;Â 
Â  Â  Â  Â  Â  Â  Â  suggestions.appendChild(option);Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  loginBtn.textContent='ç™»å…¥ç³»çµ±';Â 
Â  Â  Â  Â  Â  loginBtn.onclick=()=>window.location.href='login.html';
Â  Â  Â  Â  Â  userInfo.textContent='';Â 
Â  Â  Â  Â  Â  loginBtn.style.display='none';Â 
Â  Â  Â  Â  Â  userInfo.style.display='none';
Â  Â  Â  Â  Â  pleaseLogin.style.display='flex';Â 
Â  Â  Â  Â  Â  authReq.style.display='none';
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  };
Â  </script>

</body>
</html>
